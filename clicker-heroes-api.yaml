openapi: 3.0.4
info:
  title: Unofficial Clicker Heroes API
  description: Unofficial documentation for the backend-API of Clicker Heroes
  version: 0.0.1

tags:
  - name: clans
    description: Endpoints for retrieving information for clans
  - name: messages
    description: Endpoints for interaction with clan-chat messages

servers:
  - url: https://guilds.clickerheroes.com
    description: Backend API-Server for Clicker Heroes

paths:
  /clans/getGuildInfo.php:
    get:
      summary: Retrieves information for the clan of a logged in user
      tags: [clans]
      parameters:
        - in: query
          name: uid
          schema:
            type: string
          required: true
          description: The id of the user
        - in: query
          name: passwordHash
          schema:
            type: string
          required: true
          description: The password hash of the user
      responses:
        "200": # status code
          description: The Reponse-Object containing information of the clan
          content:
            text/html:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ClanResponse'
                  - $ref: '#/components/schemas/ErrorResponse'

  /clans/findGuild.php:
    get:
      summary: Returns information for the clan.
      tags: [clans]
      parameters:
        - $ref: '#/components/parameters/UnusedIdParam'
        - $ref: '#/components/parameters/UnusedPasswordParam'
        - $ref: '#/components/parameters/UnusedHighestZoneParam'
        - in: query
          name: guildName
          schema:
            type: string
          description: The name of the clan the info should be retrieved for. Returns a random clan if nothing is provided.
      responses:
        "200": # status code
          content:
            text/html:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ClanResponse'
                  - $ref: '#/components/schemas/ErrorResponse'

  /clans/guildMessageMonitor.php:
    get:
      summary: Retrieves the human-readable form of a clan-chat.
      description: > 
        This can be called for any clan.
        Login is not required.
        The user in bold is the leader of the clan.
      tags: [messages]
      parameters:
        - in: query
          name: guildName
          schema:
            type: string
          description: The name of the clan the messages should be retrieved for.
      responses:
        "200": # status code
          content:
            text/html:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/MessageMonitorResponse'
                  - $ref: '#/components/schemas/ErrorResponse'

components:
  parameters:
    UnusedIdParam:
      in: query
      name: uid
      required: true
      schema:
        type: string
        example: ignored
      description: The unique identifier for a user - can be anything and is ignored by the backend
    UnusedPasswordParam:
      in: query
      name: passwordHash
      required: true
      schema:
        type: string
        example: ignored
      description: The hashed password for a user - can be anything and is ignored by the backend
    UnusedHighestZoneParam:
      in: query
      name: highestZoneReached
      required: true
      schema:
        type: number
        example: 0
      description: The hightest zone the user reached - can be anything and is ignored by the backend

  schemas:
    ErrorResponse:
      type: object
      required:
        - success
        - reason
      properties:
        success:
          type: boolean
          enum: [false]
        reason:
          type: string
          description: "Reason why the operation failed"
      example:
        success: false
        reason: "Password mismatch"

    ClanResponse:
      type: object
      required:
        - success
        - reason
      properties:
        success:
          type: boolean
          enum: [true]
        result:
          type: object
          required:
            - guild
            - guildMembers
          properties:
            guild:
              $ref: '#/components/schemas/ClanInfo'
            guildMembers:
              $ref: '#/components/schemas/ClanMembers'
          description: "Info on the clan"

    MessageMonitorResponse:
      type: string
      description: The messages of a clan in human-readable form. The user in bold is the leader of the clan.
      example: >
        <b>Member1</b>@10 years ago: Hey guys:)<br>
        Member2@10 years ago: Yoooo<br>
        Member3@9 years ago: Is anyone still here?<br>

    ClanInfo:
      type: object
      required:
        - name
        - guildMasterUid
        - memberUids
        - currentRaidLevel
      properties:
        name:
          type: string
          example: "Example-Clan"
        guildMasterUid:
          type: string
          example: "012345678901234567890123456789"
        memberUids:
          $ref: '#/components/schemas/MemberUids'
        currentRaidLevel:
          type: number
          example: 42

    MemberUids:
      type: object
      additionalProperties:
        type: string
        enum: ["request", "member"]
      description: Map of member uids to either "request" or "member".
      example:
        "012345678901234567890123456789": "member"
        "111111111122222222223333333333": "member"
        "999999999999999999999999999999": "request"

    ClanMembers:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/ClanMember'
      example:
        "0":
          uid: "012345678901234567890123456789"
          highestZone: "2126"
          nichname: "Leader of Clans"
          chosenClass: "2"
          classLevel: "12"
          lastRewardTimestamp: "1610841600"
          lastBonusRewardTimestamp: "1610841600"
        "1":
          uid: "111111111122222222223333333333"
          highestZone: "201"
          nichname: "A Member :)"
          chosenClass: "1"
          classLevel: "2"
          lastRewardTimestamp: null
          lastBonusRewardTimestamp: null
        "2":
          uid: "999999999999999999999999999999"
          highestZone: "341"
          nichname: "Requesti"
          chosenClass: null
          classLevel: null
          lastRewardTimestamp: null
          lastBonusRewardTimestamp: null

    ClanMember:
      type: object
      properties:
        uid:
          $ref: '#/components/schemas/Uid'
        highestZone:
          $ref: '#/components/schemas/HighestZone'
        nickname:
          type: string
          example: "Bert"
        chosenClass:
          $ref: '#/components/schemas/Class'
        classLevel:
          type: string
          nullable: true
          example: "10"
        lastRewardTimestamp:
          type: string
          nullable: true
          example: "1610841600"
        lastBonusRewardTimestamp:
          type: string
          nullable: true
          example: "1610841600"

    Uid:
      type: string
      description: A unique identifier
      minLength: 1
      maxLength: 32 
      example: "111112222233333444445555566666"

    HighestZone:
      type: string
      description: The highest Zone reached by the member
      pattern: '^\d+$'
      example: "2561"

    Class:
      type: string
      enum: ["0", "1", "2"]
      nullable: true
      description: Enum representation of the class of a player. Can be "0", "1", "2", or null if no class is chosen.
      example: 1
